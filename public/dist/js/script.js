function getDataBase(e){database.ref().limitToLast(10).on("child_added",function(a){a=a.val(),DBUsersScore=Object.keys(a).map(function(e){return{name:e,score:a[e]}}),e&&e(),console.log(DBUsersScore)})}var DBUsersScore=void 0,database=void 0;$(document).ready(function(){var e={apiKey:"AIzaSyCEpS3L1i1SWVmsdY3B1Si72wMlGUC2dNE",authDomain:"sevengame-96feb.firebaseapp.com",databaseURL:"https://sevengame-96feb.firebaseio.com",projectId:"sevengame-96feb",storageBucket:"sevengame-96feb.appspot.com",messagingSenderId:"352836000520"};firebase.initializeApp(e),database=firebase.database(),getDataBase()});
function scoreSave(){var e=$(".userNameInput").val();""!==e?writeUserData(e,comma(vueData.score)):(alert("유저이름을 입력하세요."),setTimeout(function(){vueData.showModal=!0},500))}function findWithAttr(e,t,a){for(var s=0;s<e.length;s+=1)for(var o=0;o<e[s].length;o+=1)if(e[s][o][t]===a)return{rowIndex:s,index:o};return{rowIndex:-1,index:-1}}function reloadBtn(e){var t=vueData.buttons[e.rowIndex][e.index];t.state="none",t.styleClass="none";var a=new TimelineMax,s=$(".rowIndex-"+e.rowIndex+" .buttonIndex-"+e.index+" .inner.text");a.set(s,{scale:.1}),a.to(s,1,{scale:1,onStart:function(){changeStep(t,"step1"),t.color=getRandomColor(),t.state="wait"},onComplete:function(){}})}function changeStep(e,t){switch(t){case"step1":e.styleClass="step1",e.text="7";break;case"step2":e.styleClass="step2",e.text="77";break;case"step3":e.styleClass="step3",e.text="★";break;case"complete":e.text="7";break;default:alert("StepChange error!")}}function getRandomColor(){return["red","blue","yellow"][Math.floor(3*Math.random())]}function getComboScore(){var e=1;return(e=vueData.combo/100)<1&&(e+=1),console.log(e),e}function autoPlay(){function e(){for(var t=vueData.buttons,a={rowIndex:Math.floor(4*Math.random()),index:Math.floor(4*Math.random())},s=t[a.rowIndex][a.index],o=!1,r=0;r<t.length;r+=1){for(var l=0;l<t[r].length;l+=1)if(s.color===t[r][l].color&&s.styleClass===t[r][l].styleClass){$(".rowIndex-"+a.rowIndex+" .buttonIndex-"+a.index).click(),$(".rowIndex-"+r+" .buttonIndex-"+l).click(),o=!0,setTimeout(function(){e()},0);break}if(o)break}}if(autoPlayIndex<4)return console.log(autoPlayIndex),autoPlayIndex++,!1;e()}function comma(e){return(e=String(e)).replace(/(\d)(?=(?:\d{3})+(?!\d))/g,"$1,")}function changeView(e){switch(e){case"main":vueData.pageState="main";break;case"join":vueData.pageState="join";break;case"game":vueData.pageState="game";break;case"rank":getDataBase(function(){console.log(DBUsersScore),DBUsersScore=DBUsersScore.sort(function(e,t){return parseFloat(e.score)-parseFloat(t.score)}),DBUsersScore.reverse(),vueData.usersRank=DBUsersScore,vueData.pageState="rank"});break;default:vueData.pageState="main"}}function writeUserData(e,t){if(void 0!==DBUsersScore){var a=DBUsersScore.filter(function(t,a){if(t.name==e)return!0}),s=comma(t);0!==a.length&&a[0].score>s?alert("현재 점수보다 저장된 점수가 높습니다. 저장하지 않습니다."):(firebase.database().ref("user/"+e).set(s),changeView("rank"))}}function gameStart(){60!=vueData.time?location.reload():(timeFunc(),vueData.pageState="gameStart")}function timeFunc(){setTimeout(function(){if(vueData.time>=1)vueData.time-=1,timeFunc();else{comma(vueData.score);vueData.showModal=!0}},1e3)}Vue.use(VueMaterial),Vue.component("modal",{template:"#modal-template"});var vueData={pageState:"game",showModal:!1,buttons:[[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}]],pageMoveDelay:!1,usersRank:[],score:0,combo:0,time:60},vueDefaultData={pageState:"game",buttons:[[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}]],usersRank:[],score:0,combo:0,time:60},userName="",mainVue=new Vue({el:"#app",data:vueData,methods:{buttonClick:function(e,t){var a=findWithAttr(vueData.buttons,"state","select"),s=void 0,o=vueData.buttons[e][t],r={rowIndex:e,index:t};if(-1!==a.rowIndex&&-1!==a.rowIndex){if((s=vueData.buttons[a.rowIndex][a.index]).styleClass!==o.styleClass||s.color!==o.color)return s.state="wait",vueData.combo=0,!1;if("wait"!==o.state)return"select"===o.state?o.state="wait":s.state="wait",!1;var l=getComboScore();switch(vueData.score=String(vueData.score).replace(/,/gi,""),vueData.score=parseInt(vueData.score),o.styleClass){case"step1":changeStep(o,"step2"),vueData.combo+=1,vueData.score+=1e3*l;break;case"step2":changeStep(o,"step3"),vueData.combo+=1,vueData.score+=3e3*l;break;case"step3":changeStep(o,"complete"),reloadBtn(r),vueData.combo+=1,vueData.score+=5e3*l}console.log(vueData.score),vueData.score=comma(vueData.score),reloadBtn(a)}else o.state="select"}}});$(document).ready(function(){!function(){var e=document.getElementById("app");e.addEventListener("touchstart",function(e){var t=$(e.target);if(0===t.closest(".eventEnd").length){var a=t.closest(".eventObj");0!==a.closest("input").length?a.focus():a.click()}else e.preventDefault()},!1),e.addEventListener("touchend",function(e){var t=$(e.target);if(0!==t.closest(".eventEnd").length){var a=(t=$(e.target)).closest(".eventEnd");0!==a.closest("input").length?a.focus():a.click()}else console.log("end!!"),e.preventDefault()},!1),e.addEventListener("touchcancel",function(){},!1),e.addEventListener("touchmove",function(){},!1),$(".score").on("click touchstart",function(){autoPlay()})}();for(var e=vueData.buttons,t=0;t<e.length;t+=1)for(var a=0;a<e[t].length;a+=1)e[t][a].color=getRandomColor()});var autoPlayIndex=0;