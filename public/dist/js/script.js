function getDataBase(a){database.ref().limitToLast(10).on("child_added",function(e){e=e.val(),usersScore=Object.keys(e).map(function(a){return{name:a,score:e[a]}}),a&&a(),console.log(usersScore)})}var usersScore=void 0,database=void 0;$(document).ready(function(){var a={};firebase.initializeApp(a),database=firebase.database(),getDataBase()});
function findWithAttr(t,e,a){for(var s=0;s<t.length;s+=1)for(var o=0;o<t[s].length;o+=1)if(t[s][o][e]===a)return{rowIndex:s,index:o};return{rowIndex:-1,index:-1}}function reloadBtn(t){var e=vueData.buttons[t.rowIndex][t.index];e.state="none",e.styleClass="none";var a=new TimelineMax,s=$(".rowIndex-"+t.rowIndex+" .buttonIndex-"+t.index+" .inner.text");a.set(s,{scale:.1}),a.to(s,1,{scale:1,onStart:function(){changeStep(e,"step1"),e.color=getRandomColor(),e.state="wait"},onComplete:function(){}})}function changeStep(t,e){switch(e){case"step1":t.styleClass="step1",t.text="7";break;case"step2":t.styleClass="step2",t.text="77";break;case"step3":t.styleClass="step3",t.text="★";break;case"complete":t.text="7";break;default:alert("StepChange error!")}}function getRandomColor(){return["red","blue","yellow"][Math.floor(3*Math.random())]}function getComboScore(){var t=1;return(t=vueData.combo/100)<1&&(t+=1),console.log(t),t}function autoPlay(){function t(){for(var e=vueData.buttons,a={rowIndex:Math.floor(4*Math.random()),index:Math.floor(4*Math.random())},s=e[a.rowIndex][a.index],o=!1,r=0;r<e.length;r+=1){for(var l=0;l<e[r].length;l+=1)if(s.color===e[r][l].color&&s.styleClass===e[r][l].styleClass){$(".rowIndex-"+a.rowIndex+" .buttonIndex-"+a.index).click(),$(".rowIndex-"+r+" .buttonIndex-"+l).click(),o=!0,setTimeout(function(){t()},0);break}if(o)break}}if(autoPlayIndex<4)return console.log(autoPlayIndex),autoPlayIndex++,!1;t()}function comma(t){return(t=String(t)).replace(/(\d)(?=(?:\d{3})+(?!\d))/g,"$1,")}function changeView(t){switch(t){case"main":vueData.pageState="main";break;case"game":vueData.pageState="game";break;case"rank":getDataBase(function(){console.log(usersScore),usersScore=usersScore.sort(function(t,e){return parseFloat(t.score)-parseFloat(e.score)}),usersScore.reverse(),vueData.usersRank=usersScore,vueData.pageState="rank"});break;default:vueData.pageState="main"}}function writeUserData(t,e){console.log(e);var a=usersScore.filter(function(e,a){if(e.name==t)return!0});console.log(parseInt(a[0].score)),console.log(parseInt(e)),a[0].score>e?alert("현재 점수보다 저장된 점수가 높습니다. 저장하지 않습니다."):(firebase.database().ref("user/"+t).set(e),changeView("rank"))}function gameStart(){60!=vueData.time?location.reload():(timeFunc(),vueData.pageState="gameStart")}function timeFunc(){setTimeout(function(){if(vueData.time>=1)vueData.time-=1,timeFunc();else{var t=comma(vueData.score),e=window.prompt("저장할 유저 이름을 입력하세요.","닉네임");e&&writeUserData(e,t)}},1e3)}Vue.use(VueMaterial);var vueData={pageState:"game",buttons:[[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}]],usersRank:[],score:0,combo:0,time:60},vueDefaultData={pageState:"game",buttons:[[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}]],usersRank:[],score:0,combo:0,time:60},userName="",mainVue=new Vue({el:"#main",data:vueData,methods:{buttonClick:function(t,e){var a=findWithAttr(vueData.buttons,"state","select"),s=void 0,o=vueData.buttons[t][e],r={rowIndex:t,index:e};if(-1!==a.rowIndex&&-1!==a.rowIndex){if((s=vueData.buttons[a.rowIndex][a.index]).styleClass!==o.styleClass||s.color!==o.color)return s.state="wait",vueData.combo=0,!1;if("wait"!==o.state)return"select"===o.state?o.state="wait":s.state="wait",!1;var l=getComboScore();switch(o.styleClass){case"step1":changeStep(o,"step2"),vueData.combo+=1,vueData.score+=1e3*l;break;case"step2":changeStep(o,"step3"),vueData.combo+=1,vueData.score+=3e3*l;break;case"step3":changeStep(o,"complete"),reloadBtn(r),vueData.combo+=1,vueData.score+=5e3*l}reloadBtn(a)}else o.state="select"}}});$(document).ready(function(){!function(){var t=document.getElementById("main");t.addEventListener("touchstart",function(){$(event.target).closest(".eventObj").click()},!1),t.addEventListener("touchend",function(t){t.preventDefault()},!1),t.addEventListener("touchcancel",function(){},!1),t.addEventListener("touchmove",function(){},!1),$(".score").on("click touchstart",function(){autoPlay()})}();for(var t=vueData.buttons,e=0;e<t.length;e+=1)for(var a=0;a<t[e].length;a+=1)t[e][a].color=getRandomColor()});var autoPlayIndex=0;