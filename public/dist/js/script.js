function getDataBase(e){DATABASE.ref().on("child_added",function(a){var r=a.val();DB_USERS_DATA=Object.keys(r).map(function(e){return{id:e,info:r[e]}}),e&&e()})}function joinId(){var e=$(".join"),a=e.find(".userId").val(),r=e.find(".userPassword").val(),i=e.find(".userPassword2").val(),o=e.find(".userNickName").val();return r!==i?(alert("패스워드와 패스워드 확인이 일치하지 않습니다."),!1):""===a&&""===r&&""===i&&""===o?(alert("입력되지 않은 항목이 있습니다."),!1):(firebase.database().ref("user/"+a).set({password:r.toString(),nickName:o.toString(),level:1,exe:0,score:0}),alert("가입 완료."),void(vueData.pageState="game"))}function login(e,a){var r=$(".intro"),i=r.find(".userId").val(),o=r.find(".userPassword").val();if(e&&(i=e),a&&(o=a),""===i&&""===o)return alert("입력되지 않은 항목이 있습니다."),!1;getDataBase(function(){var e=getUserInfo(i);return console.log(e),void 0===e?(alert("아이디가 없습니다."),!1):e.password!==o?(alert("패스워드가 틀렸습니다."),!1):($.cookie("userId",i,{expires:30}),$.cookie("userPassword",o,{expires:30}),void(vueData.pageState="game"))})}function writeUserData(e){if(void 0!==e.id&&void 0!==e.score)var a=e.id;var r=e.score;if(void 0!==DB_USERS_DATA){var i=getUserInfo(a),o=comma(r);o=String(o).replace(/,/gi,""),o=parseInt(o);var t=parseInt(o*(i.level/100)),n=o+t,s=parseInt(String(i.exe).replace(/,/gi,""))+parseInt(1e3+n/100),d=i.level;if(d<parseInt(s/1e4)&&(d=parseInt(s/1e4),n=o+(t=parseInt(o*(d/100))),s=parseInt(String(i.exe).replace(/,/gi,""))+parseInt(1e3+n/100)),void 0!==i&&parseInt(String(i.score).replace(/,/gi,""))>parseInt(String(n).replace(/,/gi,"")))return e.cb&&e.cb(),!1;firebase.database().ref("user/"+a).set({password:i.password.toString(),nickName:i.nickName.toString(),level:d,exe:comma(s),bonus:comma(t),score:comma(n)}),e.cb&&e.cb()}}function getUserInfo(e){if(void 0!==DB_USERS_DATA){var a=DB_USERS_DATA.filter(function(a,r){if(a.id==e)return!0});return 0!==a.length?a[0].info:void 0}}var DB_USERS_DATA=void 0,DATABASE=void 0;$(document).ready(function(){var e={apiKey:"AIzaSyCEpS3L1i1SWVmsdY3B1Si72wMlGUC2dNE",authDomain:"sevengame-96feb.firebaseapp.com",databaseURL:"https://sevengame-96feb.firebaseio.com",projectId:"sevengame-96feb",storageBucket:"sevengame-96feb.appspot.com",messagingSenderId:"352836000520"};firebase.initializeApp(e),DATABASE=firebase.database(),console.log(DATABASE),getDataBase(function(){var e=$.cookie("userId"),a=$.cookie("userPassword");console.log(e),console.log(a),void 0!==e&&void 0!==a?login(e,a):vueData.pageState="intro"})});
function scoreSave(){var e=$(".userNameInput").val();""!==e?writeUserData(e,comma(vueData.gamePlayInfo.score)):(alert("유저이름을 입력하세요."),setTimeout(function(){vueData.showModal=!0},500))}function findWithAttr(e,t,a){for(var o=0;o<e.length;o+=1)for(var s=0;s<e[o].length;s+=1)if(e[o][s][t]===a)return{rowIndex:o,index:s};return{rowIndex:-1,index:-1}}function reloadBtn(e){var t=vueData.buttons[e.rowIndex][e.index];t.state="none",t.styleClass="none";var a=new TimelineMax,o=$(".rowIndex-"+e.rowIndex+" .buttonIndex-"+e.index+" .inner.text");a.set(o,{scale:.1}),a.to(o,1,{scale:1,onStart:function(){changeStep(t,"step1"),t.color=getRandomColor(),t.state="wait"},onComplete:function(){}})}function changeStep(e,t){switch(t){case"step1":e.styleClass="step1",e.text="7";break;case"step2":e.styleClass="step2",e.text="77";break;case"step3":e.styleClass="step3",e.text="★";break;case"complete":e.text="7";break;default:alert("StepChange error!")}}function getRandomColor(){return["red","blue","yellow"][Math.floor(3*Math.random())]}function getComboScore(){var e=1;return(e=vueData.gamePlayInfo.combo/100)<1&&(e+=1),e}function autoPlay(){function e(){for(var t=vueData.buttons,a={rowIndex:Math.floor(4*Math.random()),index:Math.floor(4*Math.random())},o=t[a.rowIndex][a.index],s=!1,n=0;n<t.length;n+=1){for(var r=0;r<t[n].length;r+=1)if(o.color===t[n][r].color&&o.styleClass===t[n][r].styleClass){$(".rowIndex-"+a.rowIndex+" .buttonIndex-"+a.index).click(),$(".rowIndex-"+n+" .buttonIndex-"+r).click(),s=!0,setTimeout(function(){e()},0);break}if(s)break}}if(autoPlayIndex<4)return autoPlayIndex++,!1;e()}function comma(e){return(e=String(e)).replace(/(\d)(?=(?:\d{3})+(?!\d))/g,"$1,")}function changeView(e){switch(e){case"main":vueData.pageState="main";break;case"join":vueData.pageState="join";break;case"game":vueData.pageState="game";break;case"rank":getDataBase(function(){DB_USERS_DATA=DB_USERS_DATA.sort(function(e,t){return parseFloat(e.score)-parseFloat(t.score)}),DB_USERS_DATA.reverse(),console.log(DB_USERS_DATA),vueData.usersRank=DB_USERS_DATA,vueData.pageState="rank"});break;default:vueData.pageState="main"}}function gameStart(){60!=vueData.gamePlayInfo.time?location.reload():(timeFunc(),vueData.pageState="gameStart")}function timeFunc(){setTimeout(function(){if(vueData.gamePlayInfo.time>=1)vueData.gamePlayInfo.time-=1,timeFunc();else{var e=$.cookie("userId"),t=(getUserInfo(e),comma(vueData.gamePlayInfo.score));t=String(t).replace(/,/gi,""),t=parseInt(t),writeUserData({id:e,score:t,cb:function(){getDataBase(function(){var t=getUserInfo(e);void 0===t&&alert("아이디가 없습니다."),vueData.gamePlayInfo.bonus=t.bonus,vueData.gamePlayInfo.exe=t.exe,vueData.gamePlayInfo.level=t.level,vueData.gamePlayInfo.rank=t.rank,vueData.pageState="gameEnd"})}})}},1e3)}Vue.use(VueMaterial),Vue.component("modal",{template:"#modal-template",data:function(){return{focusClass:""}},methods:{focus:function(){this.focusClass="md-input-focused"},blur:function(){""===$(".userNameInput").val()&&(this.focusClass="")}}});var vueData={pageState:"wait",showModal:!1,buttons:[[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}],[{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"},{state:"wait",text:"7",styleClass:"step1",color:"red"}]],pageMoveDelay:!1,usersRank:[],gamePlayInfo:{exe:0,level:0,bonus:0,score:0,combo:0,time:60}},userName="",mainVue=new Vue({el:"#app",data:vueData,methods:{buttonClick:function(e,t){var a=findWithAttr(vueData.buttons,"state","select"),o=void 0,s=vueData.buttons[e][t],n={rowIndex:e,index:t};if(-1!==a.rowIndex&&-1!==a.rowIndex){if((o=vueData.buttons[a.rowIndex][a.index]).styleClass!==s.styleClass||o.color!==s.color)return o.state="wait",vueData.gamePlayInfo.combo=0,!1;if("wait"!==s.state)return"select"===s.state?s.state="wait":o.state="wait",!1;var r=getComboScore();switch(vueData.gamePlayInfo.score=String(vueData.gamePlayInfo.score).replace(/,/gi,""),vueData.gamePlayInfo.score=parseInt(vueData.gamePlayInfo.score),s.styleClass){case"step1":changeStep(s,"step2"),vueData.gamePlayInfo.combo+=1,vueData.gamePlayInfo.score+=1e3*r;break;case"step2":changeStep(s,"step3"),vueData.gamePlayInfo.combo+=1,vueData.gamePlayInfo.score+=3e3*r;break;case"step3":changeStep(s,"complete"),reloadBtn(n),vueData.gamePlayInfo.combo+=1,vueData.gamePlayInfo.score+=5e3*r}vueData.gamePlayInfo.score=comma(vueData.gamePlayInfo.score),reloadBtn(a)}else s.state="select"}}});$(document).ready(function(){!function(){var e=document.getElementById("app");e.addEventListener("touchstart",function(e){var t=$(e.target);if(0===t.closest(".eventEnd").length){var a=t.closest(".eventObj");0!==a.closest("input").length?a.focus():a.click()}else e.preventDefault()},!1),e.addEventListener("touchend",function(e){var t=$(e.target);if(0!==t.closest(".eventEnd").length){var a=(t=$(e.target)).closest(".eventEnd");0!==a.closest("input").length?a.focus():a.click()}else e.preventDefault()},!1),e.addEventListener("touchcancel",function(){},!1),e.addEventListener("touchmove",function(){},!1)}();for(var e=vueData.buttons,t=0;t<e.length;t+=1)for(var a=0;a<e[t].length;a+=1)e[t][a].color=getRandomColor()});var autoPlayIndex=0;